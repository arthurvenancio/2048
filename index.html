<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="2048-estilo.css">
    <title>2048</title>
    <!--Funções de estilo-->
    <script>
        function box(){
            for(let id=0;id<16;id++){
                let caixa=document.getElementById(id);
                switch (caixa.innerHTML){
                    case '':
                        caixa.style.backgroundColor="#CCC1B2";
                        break
                    case '2':
                        caixa.style.backgroundColor="#EEE4DA";
                        caixa.style.color="#766F64";
                        break    
                    case '4':
                        caixa.style.backgroundColor="#EDE0C7";
                        caixa.style.color="#766F64";
                        break
                    case '8':
                        caixa.style.backgroundColor="#F2B178";
                        caixa.style.color="#FBF7F1";
                        break
                    case '16':
                        caixa.style.backgroundColor="#F59662";
                        caixa.style.color="#FBF7F1";
                        break
                    case '32':
                        caixa.style.backgroundColor="#F57C5C";
                        caixa.style.color="#FBF7F1";
                        break
                    case '64':
                        caixa.style.backgroundColor="#FEF4EA";
                        caixa.style.color="#FBF7F1";
                        break
                    case '128':
                        caixa.style.backgroundColor="#FBF6EF";
                        caixa.style.color="#FBF7F1";
                        break
                    case '256':
                        caixa.style.backgroundColor="#EDCC5F";
                        caixa.style.color="#FBF7F1";
                        break
                    case '512':
                        caixa.style.backgroundColor="#ECC84F";
                        caixa.style.color="#FBF7F1";
                        break
                    case '1024':
                        caixa.style.backgroundColor="#F5B93B";
                        caixa.style.color="#FBF7F1";
                        break
                    case '2048':
                        caixa.style.backgroundColor="#29271B";
                        caixa.style.color="#FBF7F1";
                        break
                }
            }
        }
    </script>
    <!--Funções de mecânicas de jogo-->
    <script>
        //iniciando o tabuleiro e randomizando inicio
        function iniciarJogo(){
            //inicializando valor de todas as caixas como vazia
            var valor=""
            for(let id=0;id<16;id++){
                document.getElementById(id).innerHTML=valor;
            }
            //inicializando 2 caixas com valor 2
            var id_inicial_1=Math.floor(Math.random() * 16)
            var id_inicial_2=Math.floor(Math.random() * 16)
            while(id_inicial_1==id_inicial_2){
                id_inicial_2=Math.floor(Math.random() * 16)
            }

            document.getElementById(id_inicial_1).innerHTML=2
            document.getElementById(id_inicial_2).innerHTML=2
            box();
        }
        //Colocando nova peça no tabuleiro
        function novoBloco(){
            var novo_bloco=Math.floor(Math.random() * 16)
            while(document.getElementById(novo_bloco).innerHTML!=""){
                novo_bloco=Math.floor(Math.random() * 16)
            }
            document.getElementById(novo_bloco).innerHTML=2
            box();
        }
        function somarAdjacente(arr){
            const resultado=[];
            let jaSomados=false;

            for(let i=0;i<arr.length;i++){
                if(i===arr.length-1 && !jaSomados){
                    resultado.push(arr[i]===""? 0:arr[i]);
                } else if(arr[i]!==""){
                    if(arr[i]===arr[i+1] && !jaSomados){
                        resultado.push(parseInt(arr[i]*2));
                        jaSomados=true;
                    } else if(i>0 && jaSomados){
                        jaSomados=false;
                        continue
                    } 
                    else {
                        resultado.push(arr[i]);
                        jaSomados=false;
                    }
                } else {
                    resultado.push(0);
                }
            }
            
            
            while(resultado.length<4){resultado.push(0)}
            for(let i=0;i<resultado.length;i++){
                if(resultado[i]===0){resultado[i]=""}
            }
            return resultado
        }
    </script>
    
</head>
<body>
    <header>
        <div class="header-titulo">2048</div>
        <div class="pontuacao">
            <p>Pontuação:</p>
            <span id="pontuacao-atual">0</span>
        </div>
        <div class="pontuacao">
            <p>Recorde:</p>
            <span id="pontuacao-max">0</span>
        </div>
        
        <button id="reiniciar" type="button" >Reiniciar</button>
        
        <button id="desfazer" type="button">Desfazer</button>
    </header>
    <main>
        <p class="disclaimer">Essa página tem intuitos apenas educacionais</p>
        <div class="box-principal">
            <div class="box-singular" id="0"></div>
            <div class="box-singular" id="1"></div>
            <div class="box-singular" id="2"></div>
            <div class="box-singular" id="3"></div>
            <div class="box-singular" id="4"></div>
            <div class="box-singular" id="5"></div>
            <div class="box-singular" id="6"></div>
            <div class="box-singular" id="7"></div>
            <div class="box-singular" id="8"></div>
            <div class="box-singular" id="9"></div>
            <div class="box-singular" id="10"></div>
            <div class="box-singular" id="11"></div>
            <div class="box-singular" id="12"></div>
            <div class="box-singular" id="13"></div>
            <div class="box-singular" id="14"></div>
            <div class="box-singular" id="15"></div>
        </div>
    </main>
    <!--Chamando Funções-->
    <script>
        //botão de reiniciar
        document.getElementById('reiniciar').addEventListener('click',iniciarJogo);
        document.getElementById('desfazer').addEventListener('click',novoBloco);
        //carregar o jogo quando a página carregar
        window.addEventListener('load', iniciarJogo);
        //implementando a mecânica de movimento
        document.addEventListener('keydown', (event) => {
            //iniciando matriz do tabuleiro
            const matriz = [];
            for (let row = 0; row < 4; row++) {
            matriz[row] = []; 
            for (let col = 0; col < 4; col++) {
                matriz[row][col] = document.getElementById(4*row+col) 
                //checando se o valor é um NaN e reiniciando-o como ""
                if(isNaN(parseInt(matriz[row][col].innerHTML))){
                            matriz[row][col].innerHTML=""
                        }
            }
            }
            //função de movimento para cima
            if (event.key === 'ArrowUp') {
                for(col=0;col<4;col++){
                    //Modificando espaços vazios para ficar no final da coluna
                    let vazio=[]
                        for(let i=0;i<4;i++){
                            if(matriz[i][col].innerHTML!=""){
                                vazio.push(matriz[i][col].innerHTML);
                            }
                        }
                        while(vazio.length<4){
                            vazio.push("")
                        }
                    
                    //Checagem de quantidade de dobras
                    let movimento=[]
                        console.log('essa é a coluna '+(col+1))
                        console.log(vazio)
                        movimento=somarAdjacente(vazio)
                        console.log(vazio)
                        //código de movimentação instavel
                        for(let i=0;i<4;i++){
                            matriz[i][col].innerHTML=movimento[i];
                        }
               }
               novoBloco(); 
            } else if (event.key === 'ArrowDown') {
                // A tecla de seta para baixo foi pressionada
                
            } else if (event.key === 'ArrowLeft') {
                // A tecla de seta para a esquerda foi pressionada
                
            } else if (event.key === 'ArrowRight') {
                // A tecla de seta para a direita foi pressionada
                
            }
            });
    </script>

</body>
</html>